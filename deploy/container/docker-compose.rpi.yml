name: rusty-pinch-pi

services:
  rusty-pinch-telegram:
    platform: ${RUSTY_PINCH_DOCKER_PLATFORM:-linux/arm64}
    build:
      context: ../../..
      dockerfile: rusty-pinch/deploy/container/Dockerfile
    image: ${RUSTY_PINCH_IMAGE:-rusty-pinch:pi-local}
    env_file:
      - ./rusty-pinch.rpi.env
    command: ["channels", "telegram"]
    init: true
    volumes:
      - ${RUSTY_PINCH_HOST_STATE_DIR:-./state}/data:/var/lib/rusty-pinch/data
      - ${RUSTY_PINCH_HOST_STATE_DIR:-./state}/workspace:/var/lib/rusty-pinch/workspace
    healthcheck:
      test: ["CMD", "rusty-pinch", "doctor"]
      interval: 60s
      timeout: 10s
      retries: 3
      start_period: 30s
    logging:
      driver: json-file
      options:
        max-size: "10m"
        max-file: "5"
    restart: unless-stopped

  rusty-pinch-whatsapp:
    platform: ${RUSTY_PINCH_DOCKER_PLATFORM:-linux/arm64}
    build:
      context: ../../..
      dockerfile: rusty-pinch/deploy/container/Dockerfile
    image: ${RUSTY_PINCH_IMAGE:-rusty-pinch:pi-local}
    env_file:
      - ./rusty-pinch.rpi.env
    command: ["channels", "whatsapp"]
    init: true
    volumes:
      - ${RUSTY_PINCH_HOST_STATE_DIR:-./state}/data:/var/lib/rusty-pinch/data
      - ${RUSTY_PINCH_HOST_STATE_DIR:-./state}/workspace:/var/lib/rusty-pinch/workspace
    healthcheck:
      test: ["CMD", "rusty-pinch", "doctor"]
      interval: 60s
      timeout: 10s
      retries: 3
      start_period: 30s
    logging:
      driver: json-file
      options:
        max-size: "10m"
        max-file: "5"
    restart: unless-stopped
    profiles: ["whatsapp"]
